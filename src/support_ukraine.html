<!-- Ukraine Support Carousel - Header Injection (CSS) -->
<style>
  /* Liquid Glass Design System */
  :root {
    --ukr-glass: rgba(255, 255, 255, 0.08);
    --ukr-glass-border: rgba(255, 255, 255, 0.18);
    --ukr-smoke-dark: rgba(0, 0, 0, 0.85);
    --ukr-smoke-medium: rgba(0, 0, 0, 0.6);
    --ukr-smoke-light: rgba(0, 0, 0, 0.3);
    --ukr-text-primary: rgba(255, 255, 255, 1);
    --ukr-text-secondary: rgba(255, 255, 255, 0.85);
    --ukr-blur-glass: 16px;
    --ukr-blur-smoke: 80px;
    --ukr-flow: cubic-bezier(0.23, 1, 0.32, 1);
    --ukr-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
    --ukr-snap: cubic-bezier(0.55, 0.055, 0.675, 0.19);
  }

  /* Container Reset - Mobile First */
  #ukraine-support-carousel {
    isolation: isolate;
    position: relative;
    z-index: 1;
    all: unset;
    display: block;
    width: 100%;
    margin: 10px auto;
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", system-ui, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    font-feature-settings: "ss01", "ss02", "ss03", "ss04", "ss05", "ss06", "zero", "kern";
    -webkit-tap-highlight-color: transparent;
    touch-action: pan-y pinch-zoom;
    opacity: 0;
    transition: opacity 0.3s ease;
    contain: layout style;
  }

  #ukraine-support-carousel.initialized {
    opacity: 1;
  }

  /* Desktop margins */
  @media (min-width: 769px) {
    #ukraine-support-carousel {
      margin: 40px auto;
    }
  }

  /* Backdrop filter support detection - ELEGANT FALLBACKS */
  @supports not (backdrop-filter: blur(1px)) and not (-webkit-backdrop-filter: blur(1px)) {
    #ukraine-support-carousel .ukr-card {
      background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.15) 0%,
        rgba(255, 255, 255, 0.08) 50%,
        rgba(255, 255, 255, 0.12) 100%
      );
      box-shadow:
        0 10px 30px rgba(0, 0, 0, 0.2),
        inset 0 1px 2px rgba(255, 255, 255, 0.2),
        inset 0 0 20px rgba(255, 255, 255, 0.05);
    }

    #ukraine-support-carousel .ukr-logo {
      background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.95) 0%,
        rgba(255, 255, 255, 0.9) 100%
      );
      box-shadow:
        0 8px 32px rgba(0, 0, 0, 0.15),
        inset 0 2px 4px rgba(255, 255, 255, 0.8);
    }

    #ukraine-support-carousel .ukr-nav-container {
      background: linear-gradient(
        135deg,
        rgba(0, 0, 0, 0.85) 0%,
        rgba(0, 0, 0, 0.75) 100%
      );
    }

    #ukraine-support-carousel .ukr-content {
      background: linear-gradient(
        to top,
        rgba(0, 0, 0, 0.99) 0%,
        rgba(0, 0, 0, 0.92) 30%,
        rgba(0, 0, 0, 0.75) 60%,
        rgba(0, 0, 0, 0.4) 80%,
        transparent 100%
      );
    }
  }

  /* Ensure all carousel elements stay within bounds */
  #ukraine-support-carousel * {
    box-sizing: border-box;
    max-width: 100%;
  }

  /* Focus states - mobile optimized */
  #ukraine-support-carousel :focus {
    outline: none;
  }

  #ukraine-support-carousel :focus-visible {
    outline: 3px solid rgba(255, 255, 255, 0.5);
    outline-offset: 2px;
  }

  #ukraine-support-carousel *,
  #ukraine-support-carousel *::before,
  #ukraine-support-carousel *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    border: 0;
  }

  /* Main Wrapper - Mobile First */
  #ukraine-support-carousel .ukr-wrapper {
    position: relative;
    width: 100%;
    background: transparent;
    min-height: auto;
  }

  /* Viewport - Mobile First - IMPROVED MOBILE LAYOUT */
  #ukraine-support-carousel .ukr-viewport {
    position: relative;
    width: 100%;
    margin: 0 auto;
    padding: 0; /* Remove padding on mobile for full width */
    box-sizing: border-box;
    contain: layout;
    overflow: visible;
  }

  @media (min-width: 481px) {
    #ukraine-support-carousel .ukr-viewport {
      padding: 16px 16px;
    }
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-viewport {
      padding: 24px 20px;
      max-width: min(1200px, 100vw);
    }
  }

  /* Track Container - Mobile First - FIXED MOBILE DISPLAY */
  #ukraine-support-carousel .ukr-track-container {
    position: relative;
    width: 100%;
    margin: 0 auto;
    height: auto;
    aspect-ratio: 3/2;
    max-height: calc(100vh - 100px); /* Reduced to ensure visibility */
    min-height: 250px; /* Increased minimum height */
    overflow: hidden;
    border-radius: 0; /* No border radius on mobile for full width */
    box-sizing: border-box;
    -webkit-overflow-scrolling: touch;
    contain: layout style paint;
    will-change: auto;
  }

  @media (min-width: 481px) {
    #ukraine-support-carousel .ukr-track-container {
      border-radius: 16px;
      max-height: 400px;
      margin: 0 16px;
    }
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-track-container {
      border-radius: 32px;
      height: 600px;
      max-height: 600px;
      margin: 0 auto;
    }
  }

  /* Track - Mobile Optimized - GPU ACCELERATED */
  #ukraine-support-carousel .ukr-track {
    position: absolute;
    display: flex;
    align-items: center;
    height: 100%;
    left: 0;
    transition: transform 0.6s var(--ukr-snap);
    transform: translate3d(0, 0, 0);
    backface-visibility: hidden;
    will-change: transform;
    contain: layout;
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-track {
      transition: transform 1s var(--ukr-flow);
    }
  }

  /* Slides - Mobile First - FIXED CENTERING */
  #ukraine-support-carousel .ukr-slide {
    flex: 0 0 100%;
    width: 100%;
    height: 100%;
    padding: 0; /* Removed padding for proper centering */
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    z-index: 1;
    backface-visibility: hidden;
    min-width: 100%;
    max-width: 100%;
    contain: layout style;
  }

  @media (min-width: 481px) {
    #ukraine-support-carousel .ukr-slide {
      flex: 0 0 90%;
      width: 90%;
      padding: 0 8px;
    }
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-slide {
      flex: 0 0 900px;
      width: 900px;
      height: 600px;
      padding: 0 20px;
    }
  }

  /* Glass Cards - LIQUID GLASS DESIGN - MOBILE OPTIMIZED */
  #ukraine-support-carousel .ukr-card {
    position: relative;
    display: block;
    width: 100%;
    height: 100%;
    aspect-ratio: 3/2;
    border-radius: 0; /* No radius on mobile */
    overflow: hidden;
    text-decoration: none;
    transform: scale(1) translateZ(0); /* Full scale on mobile */
    opacity: 1; /* Full opacity on mobile */
    transition: transform 0.6s var(--ukr-snap), opacity 0.6s var(--ukr-snap);
    cursor: pointer;
    contain: layout style paint;
    -webkit-touch-callout: none;
    user-select: none;

    /* Liquid glass with performance optimization */
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.06) 0%,
      rgba(255, 255, 255, 0.02) 50%,
      rgba(255, 255, 255, 0.04) 100%
    );
    backdrop-filter: blur(8px) saturate(120%);
    -webkit-backdrop-filter: blur(8px) saturate(120%);
    box-shadow: none; /* Remove shadow on mobile */
    will-change: auto;
  }

  /* Enhanced glass on mobile active cards */
  @media (max-width: 768px) {
    #ukraine-support-carousel .ukr-slide.active .ukr-card {
      backdrop-filter: blur(16px) saturate(130%) brightness(1.02);
      -webkit-backdrop-filter: blur(16px) saturate(130%) brightness(1.02);
      background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.08) 0%,
        rgba(255, 255, 255, 0.03) 50%,
        rgba(255, 255, 255, 0.05) 100%
      );
    }
  }

  @media (min-width: 481px) {
    #ukraine-support-carousel .ukr-card {
      border-radius: 16px;
      transform: scale(0.95) translateZ(0);
      opacity: 0.9;
      box-shadow:
        0 10px 30px rgba(0, 0, 0, 0.15),
        inset 0 1px 1px rgba(255, 255, 255, 0.06),
        inset 0 0 0 0.5px rgba(255, 255, 255, 0.08);
    }
  }

  @media (min-width: 481px) {
    #ukraine-support-carousel .ukr-card {
      border-radius: 16px;
    }
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-card {
      border-radius: 24px;
      transform: scale(0.92) translateZ(0);
      opacity: 0.85;
      transition: transform 1s var(--ukr-flow), opacity 1s var(--ukr-flow);
      /* Desktop liquid glass - more pronounced */
      background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.1) 0%,
        rgba(255, 255, 255, 0.04) 40%,
        rgba(255, 255, 255, 0.06) 100%
      );
      backdrop-filter: blur(20px) saturate(140%) brightness(1.03);
      -webkit-backdrop-filter: blur(20px) saturate(140%) brightness(1.03);
      box-shadow:
        0 20px 50px rgba(0, 0, 0, 0.2),
        inset 0 2px 2px rgba(255, 255, 255, 0.1),
        inset 0 0 0 0.5px rgba(255, 255, 255, 0.12);
    }

    /* Desktop active card - enhanced glass */
    #ukraine-support-carousel .ukr-slide.active .ukr-card {
      backdrop-filter: blur(30px) saturate(150%) brightness(1.05);
      -webkit-backdrop-filter: blur(30px) saturate(150%) brightness(1.05);
      background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.12) 0%,
        rgba(255, 255, 255, 0.05) 40%,
        rgba(255, 255, 255, 0.08) 100%
      );
    }
  }

  /* Active Card - Mobile */
  #ukraine-support-carousel .ukr-slide.active .ukr-card {
    transform: scale(1) translateZ(0);
    opacity: 1;
    box-shadow:
      0 15px 40px rgba(0, 0, 0, 0.25),
      inset 0 2px 3px rgba(255, 255, 255, 0.12),
      inset 0 0 30px rgba(255, 255, 255, 0.05);
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-slide.active .ukr-card {
      box-shadow:
        0 30px 80px rgba(0, 0, 0, 0.3),
        inset 0 3px 5px rgba(255, 255, 255, 0.15),
        inset 0 0 50px rgba(255, 255, 255, 0.08),
        0 0 0 1px rgba(255, 255, 255, 0.05);
    }
  }

  /* Subtle shimmer for active cards */
  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-slide.active .ukr-card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(
        105deg,
        transparent 40%,
        rgba(255, 255, 255, 0.1) 50%,
        transparent 60%
      );
      opacity: 0;
      transform: translateX(-100%);
      animation: shimmer 4s ease-in-out infinite;
      animation-delay: 2s;
      pointer-events: none;
      will-change: transform, opacity;
    }
  }

  @keyframes shimmer {
    0% {
      opacity: 0;
      transform: translateX(-100%);
    }
    50% {
      opacity: 1;
    }
    100% {
      opacity: 0;
      transform: translateX(100%);
    }
  }

  /* Pre-active states - Desktop only */
  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-slide.pre-active .ukr-card {
      transform: scale(0.95) translateZ(0);
      opacity: 0.9;
    }
  }

  /* Hover State - Desktop only - LIQUID GLASS */
  @media (hover: hover) and (min-width: 769px) {
    #ukraine-support-carousel .ukr-card:hover {
      transform: scale(1.01) translateZ(0);
      box-shadow:
        0 25px 60px rgba(0, 0, 0, 0.25),
        inset 0 3px 4px rgba(255, 255, 255, 0.15),
        inset 0 0 0 0.5px rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(25px) saturate(145%) brightness(1.04);
      -webkit-backdrop-filter: blur(25px) saturate(145%) brightness(1.04);
    }

    #ukraine-support-carousel .ukr-slide.active .ukr-card:hover {
      transform: scale(1.015) translateZ(0);
      box-shadow:
        0 35px 90px rgba(0, 0, 0, 0.35),
        inset 0 4px 6px rgba(255, 255, 255, 0.18),
        inset 0 0 60px rgba(255, 255, 255, 0.1),
        0 0 0 1px rgba(255, 255, 255, 0.08);
    }
  }

  /* Video Layer - LIQUID GLASS INTEGRATION */
  #ukraine-support-carousel .ukr-video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    opacity: 0;
    z-index: 1;
    transition: opacity 0.8s ease-in-out;
    pointer-events: none;
    will-change: auto;
    contain: strict;
    /* Subtle color adjustment for glass effect */
    filter: saturate(1.1) contrast(1.05);
  }

  #ukraine-support-carousel .ukr-video.loaded {
    opacity: 0.88;
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-video.loaded {
      opacity: 0.85;
      filter: saturate(1.15) contrast(1.08) brightness(0.98);
    }
  }

  /* Video glass overlay - subtle enhancement */
  #ukraine-support-carousel .ukr-video-overlay {
    display: block;
    position: absolute;
    inset: 0;
    z-index: 2;
    background: radial-gradient(
      circle at center,
      transparent 0%,
      rgba(255, 255, 255, 0.02) 50%,
      rgba(255, 255, 255, 0.04) 100%
    );
    mix-blend-mode: overlay;
    pointer-events: none;
  }

  /* Black Smoke Overlay - LIQUID GLASS BLEND */
  #ukraine-support-carousel .ukr-smoke {
    position: absolute;
    inset: 0;
    z-index: 3;
    pointer-events: none;

    /* Enhanced gradient with glass effect */
    background:
      radial-gradient(ellipse 150% 80% at 50% 100%,
        rgba(0, 0, 0, 0.95) 0%,
        rgba(0, 0, 0, 0.85) 15%,
        rgba(0, 0, 0, 0.7) 30%,
        rgba(0, 0, 0, 0.4) 50%,
        transparent 75%
      );
    /* Subtle glass blur at edges */
    backdrop-filter: blur(2px);
    -webkit-backdrop-filter: blur(2px);
  }

  /* Animated smoke particles - Desktop only */
  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-smoke {
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }

    #ukraine-support-carousel .ukr-smoke::before {
      content: '';
      position: absolute;
      bottom: -60px;
      left: -30%;
      width: 160%;
      height: 350px;
      background: radial-gradient(
        ellipse at 50% 100%,
        rgba(0, 0, 0, 0.7) 0%,
        rgba(0, 0, 0, 0.4) 30%,
        transparent 65%
      );
      filter: blur(60px);
      opacity: 0.6;
      animation: smoke-drift 20s ease-in-out infinite;
      will-change: auto;
    }
  }

  @keyframes smoke-drift {
    0%, 100% {
      transform: translateX(0) scale(1);
      opacity: 0.3;
    }
    50% {
      transform: translateX(10%) scale(1.1);
      opacity: 0.6;
    }
  }

  /* Content - LIQUID GLASS SMOKE - MOBILE READABLE */
  #ukraine-support-carousel .ukr-content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 20px 16px 70px 16px; /* More padding for readability */
    z-index: 4;

    /* Stronger gradient for mobile readability */
    background: linear-gradient(
      to top,
      rgba(0, 0, 0, 0.99) 0%,
      rgba(0, 0, 0, 0.95) 25%,
      rgba(0, 0, 0, 0.85) 45%,
      rgba(0, 0, 0, 0.65) 65%,
      rgba(0, 0, 0, 0.3) 85%,
      transparent 100%
    );

    /* Liquid glass blur on mobile */
    backdrop-filter: blur(20px) saturate(60%);
    -webkit-backdrop-filter: blur(20px) saturate(60%);

    /* Tighter mask for better text visibility */
    mask-image: linear-gradient(
      to top,
      black 0%,
      black 75%,
      transparent 95%
    );
    -webkit-mask-image: linear-gradient(
      to top,
      black 0%,
      black 75%,
      transparent 95%
    );

    /* Mobile animations */
    opacity: 0;
    transform: translate3d(0, 40px, 0);
    transition: transform 0.8s var(--ukr-snap), opacity 0.8s var(--ukr-snap);
    transition-delay: 0.2s;
    will-change: transform, opacity;
  }

  @media (min-width: 481px) {
    #ukraine-support-carousel .ukr-content {
      padding: 24px;
      padding-bottom: 80px;
    }
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-content {
      padding: 36px;
      transform: translate3d(0, 60px, 0);
      transition: transform 1.4s var(--ukr-flow), opacity 1.4s var(--ukr-flow);
      transition-delay: 0.3s;
      /* Enhanced desktop glass blur */
      backdrop-filter: blur(50px) saturate(60%) brightness(0.98);
      -webkit-backdrop-filter: blur(50px) saturate(60%) brightness(0.98);
      background: linear-gradient(
        to top,
        rgba(0, 0, 0, 0.99) 0%,
        rgba(0, 0, 0, 0.92) 25%,
        rgba(0, 0, 0, 0.78) 45%,
        rgba(0, 0, 0, 0.55) 65%,
        transparent 100%
      );
    }

    /* Add subtle glass refraction effect */
    #ukraine-support-carousel .ukr-content::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 200px;
      background: linear-gradient(
        to top,
        rgba(255, 255, 255, 0.03) 0%,
        transparent 100%
      );
      pointer-events: none;
    }
  }

  #ukraine-support-carousel .ukr-slide.active .ukr-content {
    opacity: 1;
    transform: translate3d(0, 0, 0);
  }

  /* Logo Container - Mobile First */
  #ukraine-support-carousel .ukr-logo-container {
    display: inline-flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 8px;
    opacity: 0;
    transform: translate3d(0, 20px, 0);
    transition: transform 0.8s var(--ukr-snap), opacity 0.8s var(--ukr-snap);
    transition-delay: 0.3s;
    position: relative;
    z-index: 10;
    will-change: transform, opacity;
  }

  @media (min-width: 481px) {
    #ukraine-support-carousel .ukr-logo-container {
      gap: 24px;
      margin-bottom: 12px;
    }
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-logo-container {
      gap: 32px;
      margin-bottom: 16px;
      transition: transform 1.2s var(--ukr-flow), opacity 1.2s var(--ukr-flow);
      transition-delay: 0.4s;
    }
  }

  #ukraine-support-carousel .ukr-slide.active .ukr-logo-container {
    opacity: 1;
    transform: translateY(0);
  }

  /* Glass Logo - LARGER ICONS WITH MINIMAL PADDING */
  #ukraine-support-carousel .ukr-logo {
    position: relative;
    width: 56px;
    height: 56px;
    padding: 6px; /* Reduced from 10px */
    border-radius: 14px;
    overflow: visible;
    flex-shrink: 0;
    isolation: isolate;

    /* Elegant white glass prism */
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.92) 0%,
      rgba(255, 255, 255, 0.85) 50%,
      rgba(255, 255, 255, 0.88) 100%
    );
    backdrop-filter: blur(40px) saturate(180%) brightness(1.1);
    -webkit-backdrop-filter: blur(40px) saturate(180%) brightness(1.1);
    box-shadow:
      0 8px 32px rgba(0, 0, 0, 0.12),
      0 2px 8px rgba(255, 255, 255, 0.4),
      inset 0 2px 4px rgba(255, 255, 255, 0.6),
      inset 0 0 0 0.5px rgba(255, 255, 255, 0.8);

    transition: all 0.4s var(--ukr-snap);
    will-change: auto;
  }

  @media (min-width: 481px) {
    #ukraine-support-carousel .ukr-logo {
      width: 64px;
      height: 64px;
      padding: 8px; /* Reduced from 12px */
    }
  }

  /* Only add enhanced effects on desktop */
  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-logo {
      width: 80px;
      height: 80px;
      padding: 10px; /* Reduced from 16px */
      border-radius: 22px;
      background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.9) 0%,
        rgba(255, 255, 255, 0.82) 40%,
        rgba(255, 255, 255, 0.86) 100%
      );
      backdrop-filter: blur(60px) saturate(200%) brightness(1.15);
      -webkit-backdrop-filter: blur(60px) saturate(200%) brightness(1.15);
      box-shadow:
        0 12px 48px rgba(0, 0, 0, 0.15),
        0 4px 16px rgba(255, 255, 255, 0.5),
        inset 0 3px 6px rgba(255, 255, 255, 0.7),
        inset 0 0 0 0.5px rgba(255, 255, 255, 0.9),
        0 0 0 1px rgba(255, 255, 255, 0.2);
    }
  }

  /* Simplified float animation */
  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-logo {
      animation: float 6s ease-in-out infinite;
    }
  }

  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
  }

  #ukraine-support-carousel .ukr-logo img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    position: relative;
    z-index: 2;
    display: block;
  }

  /* Logo hover - Desktop only - SIMPLIFIED */
  @media (hover: hover) and (min-width: 769px) {
    #ukraine-support-carousel .ukr-card:hover .ukr-logo {
      transform: translateY(-5px) scale(1.03);
    }
  }

  /* Special More Card - BLUE GLASS */
  #ukraine-support-carousel .ukr-more .ukr-logo {
    background: linear-gradient(
      135deg,
      rgba(0, 87, 183, 0.92) 0%,
      rgba(0, 87, 183, 0.85) 50%,
      rgba(0, 87, 183, 0.88) 100%
    );
    backdrop-filter: blur(40px) saturate(160%) brightness(1.05);
    -webkit-backdrop-filter: blur(40px) saturate(160%) brightness(1.05);
    box-shadow:
      0 8px 32px rgba(0, 0, 0, 0.2),
      0 2px 8px rgba(0, 87, 183, 0.4),
      inset 0 2px 4px rgba(255, 255, 255, 0.3),
      inset 0 0 0 0.5px rgba(255, 255, 255, 0.25);
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-more .ukr-logo {
      background: linear-gradient(
        135deg,
        rgba(0, 87, 183, 0.9) 0%,
        rgba(0, 87, 183, 0.82) 40%,
        rgba(0, 87, 183, 0.86) 100%
      );
      backdrop-filter: blur(60px) saturate(180%) brightness(1.08);
      -webkit-backdrop-filter: blur(60px) saturate(180%) brightness(1.08);
      box-shadow:
        0 12px 48px rgba(0, 0, 0, 0.25),
        0 4px 16px rgba(0, 87, 183, 0.5),
        inset 0 3px 6px rgba(255, 255, 255, 0.35),
        inset 0 0 0 0.5px rgba(255, 255, 255, 0.3),
        0 0 0 1px rgba(0, 87, 183, 0.3);
    }
  }

  #ukraine-support-carousel .ukr-more .ukr-logo svg {
    width: 30px;
    height: 30px;
    fill: #FFD700;
    display: block;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-more .ukr-logo svg {
      width: 40px;
      height: 40px;
    }
  }

  /* Text Styling - Mobile First */
  #ukraine-support-carousel .ukr-text {
    flex: 1;
    opacity: 0;
    transform: translateY(20px);
    transition: transform 0.8s var(--ukr-snap), opacity 0.8s var(--ukr-snap);
    transition-delay: 0.4s;
    will-change: transform, opacity;
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-text {
      transition: transform 1.2s var(--ukr-flow), opacity 1.2s var(--ukr-flow);
      transition-delay: 0.5s;
    }
  }

  #ukraine-support-carousel .ukr-slide.active .ukr-text {
    opacity: 1;
    transform: translateY(0);
  }

  #ukraine-support-carousel .ukr-title {
    font-size: 20px;
    font-weight: 600;
    color: var(--ukr-text-primary);
    margin-bottom: 4px;
    letter-spacing: -0.02em;
    line-height: 1.1;
    text-shadow: 0 1px 10px rgba(0, 0, 0, 0.6);
  }

  @media (min-width: 481px) {
    #ukraine-support-carousel .ukr-title {
      font-size: 26px;
      margin-bottom: 6px;
    }
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-title {
      font-size: 38px;
      margin-bottom: 8px;
      text-shadow: 0 2px 20px rgba(0, 0, 0, 0.6);
    }
  }

  #ukraine-support-carousel .ukr-description {
    font-size: 14px;
    font-weight: 400;
    color: var(--ukr-text-secondary);
    letter-spacing: -0.01em;
    line-height: 1.3;
    text-shadow: 0 1px 8px rgba(0, 0, 0, 0.6);
  }

  @media (min-width: 481px) {
    #ukraine-support-carousel .ukr-description {
      font-size: 16px;
      line-height: 1.4;
    }
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-description {
      font-size: 19px;
      text-shadow: 0 1px 10px rgba(0, 0, 0, 0.6);
    }
  }

  /* Navigation Container - LIQUID GLASS PANEL - MOBILE FIXED */
  #ukraine-support-carousel .ukr-nav-container {
    position: absolute;
    bottom: 10px; /* Closer to bottom on mobile */
    left: 50%;
    transform: translateX(-50%);
    z-index: 5;
    display: flex;
    align-items: center;
    gap: 10px; /* Smaller gap on mobile */
    padding: 6px 12px; /* Smaller padding on mobile */
    border-radius: 20px;
    pointer-events: all;
    opacity: 0;
    transition: opacity 0.3s ease 0.5s;

    /* Elegant glass panel */
    background: linear-gradient(
      135deg,
      rgba(0, 0, 0, 0.6) 0%,
      rgba(0, 0, 0, 0.5) 100%
    );
    backdrop-filter: blur(20px) saturate(120%) brightness(0.9);
    -webkit-backdrop-filter: blur(20px) saturate(120%) brightness(0.9);
    box-shadow:
      0 2px 12px rgba(0, 0, 0, 0.3),
      inset 0 1px 1px rgba(255, 255, 255, 0.1);
  }

  #ukraine-support-carousel.initialized .ukr-nav-container {
    opacity: 1;
  }

  @media (min-width: 481px) {
    #ukraine-support-carousel .ukr-nav-container {
      bottom: 24px;
      gap: 14px;
      padding: 10px 18px;
    }
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-nav-container {
      top: 32px;
      right: 32px;
      bottom: auto;
      left: auto;
      transform: none;
      gap: 10px;
      padding: 8px 12px;
      border-radius: 20px;
      max-width: calc(100% - 64px);
      background: linear-gradient(
        135deg,
        rgba(0, 0, 0, 0.45) 0%,
        rgba(0, 0, 0, 0.35) 100%
      );
      backdrop-filter: blur(40px) saturate(140%) brightness(0.95);
      -webkit-backdrop-filter: blur(40px) saturate(140%) brightness(0.95);
      box-shadow:
        0 4px 24px rgba(0, 0, 0, 0.3),
        inset 0 2px 3px rgba(255, 255, 255, 0.12),
        inset 0 0 0 0.5px rgba(255, 255, 255, 0.18),
        0 0 0 1px rgba(255, 255, 255, 0.05);
    }
  }

  /* Navigation Buttons - Mobile First - SMALLER ON MOBILE */
  #ukraine-support-carousel .ukr-nav {
    width: 36px; /* Reduced from 44px */
    height: 36px; /* Reduced from 44px */
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    pointer-events: all;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;

    /* Mobile glass button */
    background: rgba(255, 255, 255, 0.2);
    border: none;
    box-shadow: inset 0 0 0 0.5px rgba(255, 255, 255, 0.1);
  }

  @media (min-width: 481px) {
    #ukraine-support-carousel .ukr-nav {
      width: 40px;
      height: 40px;
    }
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-nav {
      width: 28px;
      height: 28px;
      transition: all 0.4s var(--ukr-flow);
      background: rgba(255, 255, 255, 0.25);
      border: none;
      box-shadow: inset 0 0 0 0.5px rgba(255, 255, 255, 0.15);
    }

    #ukraine-support-carousel .ukr-nav::after {
      content: '';
      position: absolute;
      inset: -8px;
      border-radius: 50%;
      pointer-events: all;
    }
  }

  /* Mobile touch feedback */
  #ukraine-support-carousel .ukr-nav:active {
    background: rgba(255, 255, 255, 0.35);
    transform: scale(0.9);
  }

  @media (hover: hover) and (min-width: 769px) {
    #ukraine-support-carousel .ukr-nav:hover {
      background: rgba(255, 255, 255, 0.35);
      transform: scale(1.1);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
    }
  }

  #ukraine-support-carousel .ukr-nav:disabled,
  #ukraine-support-carousel .ukr-nav.disabled {
    opacity: 0.3;
    cursor: not-allowed;
    pointer-events: none;
  }

  #ukraine-support-carousel .ukr-nav svg {
    width: 20px;
    height: 20px;
    fill: var(--ukr-text-primary);
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-nav svg {
      width: 16px;
      height: 16px;
    }
  }

  /* Dots - Mobile First */
  #ukraine-support-carousel .ukr-dots {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  @media (min-width: 481px) {
    #ukraine-support-carousel .ukr-dots {
      gap: 10px;
    }
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-dots {
      gap: 12px;
    }
  }

  #ukraine-support-carousel .ukr-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.4);
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    -webkit-tap-highlight-color: transparent;
    padding: 0;
    touch-action: manipulation;
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-dot {
      width: 8px;
      height: 8px;
      background: rgba(255, 255, 255, 0.45);
      transition: all 0.4s var(--ukr-flow);
    }
  }

  #ukraine-support-carousel .ukr-dot.active {
    width: 24px;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.9);
    box-shadow: 0 0 12px rgba(255, 255, 255, 0.5);
  }

  @media (min-width: 769px) {
    #ukraine-support-carousel .ukr-dot.active {
      width: 32px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.95);
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.6);
    }
  }

  /* Loading State - SIMPLIFIED */
  #ukraine-support-carousel .ukr-loading {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 32px;
    height: 32px;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  #ukraine-support-carousel .ukr-card.loading .ukr-loading {
    opacity: 1;
  }

  #ukraine-support-carousel .ukr-loading::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 50%;
    border: 2px solid transparent;
    border-top: 2px solid rgba(255, 255, 255, 0.5);
    border-right: 2px solid rgba(255, 255, 255, 0.5);
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* Touch indicators */
  @media (max-width: 768px) {
    #ukraine-support-carousel .ukr-track-container::before,
    #ukraine-support-carousel .ukr-track-container::after {
      content: '';
      position: absolute;
      top: 0;
      bottom: 0;
      width: 30px;
      z-index: 4;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    #ukraine-support-carousel .ukr-track-container::before {
      left: 0;
      background: linear-gradient(to right, rgba(0, 0, 0, 0.2), transparent);
    }

    #ukraine-support-carousel .ukr-track-container::after {
      right: 0;
      background: linear-gradient(to left, rgba(0, 0, 0, 0.2), transparent);
    }

    #ukraine-support-carousel .ukr-track-container.can-scroll-left::before,
    #ukraine-support-carousel .ukr-track-container.can-scroll-right::after {
      opacity: 1;
    }
  }

  /* Performance optimizations */
  #ukraine-support-carousel .ukr-slide:not(.active):not(.pre-active) .ukr-content,
  #ukraine-support-carousel .ukr-slide:not(.active):not(.pre-active) .ukr-logo-container,
  #ukraine-support-carousel .ukr-slide:not(.active):not(.pre-active) .ukr-text {
    opacity: 0 !important;
    transform: translateY(40px) !important;
    transition: none !important;
  }

  #ukraine-support-carousel .ukr-slide:not(.active) .ukr-video {
    display: none;
  }

  #ukraine-support-carousel .ukr-slide.active .ukr-video {
    display: block;
  }

  /* Reduce motion preference support */
  @media (prefers-reduced-motion: reduce) {
    #ukraine-support-carousel * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }

    #ukraine-support-carousel .ukr-card,
    #ukraine-support-carousel .ukr-logo,
    #ukraine-support-carousel .ukr-nav-container,
    #ukraine-support-carousel .ukr-content {
      backdrop-filter: none !important;
      -webkit-backdrop-filter: none !important;
    }
  }

  /* GPU optimization hints */
  #ukraine-support-carousel .ukr-card,
  #ukraine-support-carousel .ukr-track {
    transform: translate3d(0, 0, 0);
    backface-visibility: hidden;
    perspective: 1000px;
  }
</style>

<!-- Ukraine Support Carousel - Footer Injection (JavaScript) -->
<script>
(function() {
  'use strict';

  // Performance-optimized configuration
  const CONFIG = {
    autoplayDelay: 7000,
    autoplayDelayMobile: 6000,
    animationDuration: 1000,
    animationDurationMobile: 600,
    videoLoadDelay: 100,
    swipeThreshold: 30,
    swipeThresholdMobile: 20,
    velocityThreshold: 0.3,
    maxPreloadVideos: 2,
    videoTimeout: 5000,
    frameInterval: 50 // For reverse playback
  };

  // Performance utilities
  const raf = window.requestAnimationFrame || (cb => setTimeout(cb, 16));
  const caf = window.cancelAnimationFrame || clearTimeout;

  // Debounce with immediate option
  const debounce = (func, wait, immediate) => {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        timeout = null;
        if (!immediate) func(...args);
      };
      const callNow = immediate && !timeout;
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
      if (callNow) func(...args);
    };
  };

  // Frame-based throttle for smooth animations
  const rafThrottle = (func) => {
    let rafId = null;
    return (...args) => {
      if (rafId) return;
      rafId = raf(() => {
        func(...args);
        rafId = null;
      });
    };
  };

  // Device detection with memoization
  const deviceDetection = (() => {
    let cachedTouch = null;
    let cachedMobile = null;

    return {
      isTouch: () => {
        if (cachedTouch === null) {
          cachedTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        }
        return cachedTouch;
      },
      isMobile: () => {
        if (cachedMobile === null) {
          cachedMobile = window.matchMedia('(max-width: 768px)').matches;
        }
        return cachedMobile;
      },
      reset: () => {
        cachedMobile = null;
      }
    };
  })();

  // Main carousel class
  class UkraineCarousel {
    constructor() {
      this.container = document.getElementById('ukraine-support-carousel');
      if (!this.container) {
        console.warn('Ukraine Support Carousel: Container not found');
        return;
      }

      // State management
      this.current = 0;
      this.isTransitioning = false;
      this.autoplayTimer = null;
      this.pendingOperations = new Set();
      this.videoCache = new Map();
      this.loadingVideos = new Set();
      this.isTouch = deviceDetection.isTouch();
      this.isMobile = deviceDetection.isMobile();
      this.isInitialized = false;
      this.isDestroyed = false;
      this.rafId = null;

      // Data
      this.organizations = [
        {
          title: 'United24',
          description: 'Official Ukrainian government platform',
          url: 'https://u24.gov.ua',
          video: 'https://starikov.co/content/media/2025/06/ukraine_kyiv.mp4',
          logo: 'https://starikov.co/content/images/2025/06/united_24.png'
        },
        {
          title: 'Nova Ukraine',
          description: 'Bay Area based humanitarian organization',
          url: 'https://novaukraine.org',
          video: 'https://starikov.co/content/media/2025/06/ukraine_flag_stanford.mp4',
          logo: 'https://starikov.co/content/images/2025/06/nova_ukraine.png'
        },
        {
          title: 'Come Back Alive',
          description: 'Supporting Ukrainian defenders since 2014',
          url: 'https://savelife.in.ua',
          video: 'https://starikov.co/content/media/2025/06/ukraine_donate_military.mp4',
          logo: 'https://starikov.co/content/images/2025/06/come_back_alive_dark-2.png'
        },
        {
          title: 'UAnimals',
          description: 'Protecting animals affected by war',
          url: 'https://uanimals.org',
          video: 'https://starikov.co/content/media/2025/06/ukraine_kitten.mp4',
          logo: 'https://starikov.co/content/images/2025/06/uanimals.png'
        },
        {
          title: 'More Organizations',
          description: 'Explore additional ways to help',
          url: 'https://starikov.co/support-ukraine',
          video: 'https://starikov.co/content/media/2025/06/ukraine_flag_waving.mp4',
          isMore: true
        }
      ];

      this.init();
    }

    async init() {
      try {
        // Build DOM
        this.buildHTML();
        this.cacheElements();

        // Preload critical resources
        await this.preloadCriticalAssets();

        // Setup components
        this.setupVideos();
        this.bindEvents();

        // Initialize display
        this.rafId = raf(() => {
          this.updateCarousel(false);
          this.isInitialized = true;
          this.container.classList.add('initialized');

          // Start features after initialization
          setTimeout(() => {
            if (!this.isDestroyed) {
              this.startAutoplay();
              this.preloadNextVideos();
            }
          }, 300);
        });

      } catch (error) {
        console.error('Ukraine Support Carousel: Initialization error', error);
      }
    }

    buildHTML() {
      const html = `
        <div class="ukr-wrapper">
          <div class="ukr-viewport">
            <div class="ukr-track-container">
              <div class="ukr-track">
                ${this.organizations.map((org, i) => `
                  <div class="ukr-slide ${i === 0 ? 'active' : ''}" data-index="${i}">
                    <a href="${org.url}" class="ukr-card ${org.isMore ? 'ukr-more' : ''}" target="_blank" rel="noopener noreferrer">
                      <div class="ukr-loading"></div>
                      <video class="ukr-video"
                        muted
                        playsinline
                        preload="none"
                        data-index="${i}"
                        poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
                        <source src="${org.video}" type="video/mp4">
                      </video>
                      <div class="ukr-smoke"></div>
                      <div class="ukr-content">
                        <div class="ukr-logo-container">
                          <div class="ukr-logo">
                            ${org.isMore ?
                              '<svg viewBox="0 0 24 24"><path d="M13.025 1l-2.847 2.828 6.176 6.176h-16.354v3.992h16.354l-6.176 6.176 2.847 2.828 10.975-11z"/></svg>' :
                              `<img src="${org.logo}" alt="${org.title}" loading="eager">`
                            }
                          </div>
                          <div class="ukr-text">
                            <h3 class="ukr-title">${org.title}</h3>
                            <p class="ukr-description">${org.description}</p>
                          </div>
                        </div>
                      </div>
                    </a>
                  </div>
                `).join('')}
              </div>
              <nav class="ukr-nav-container" aria-label="Carousel navigation">
                <button class="ukr-nav prev" aria-label="Previous slide" disabled>
                  <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                </button>
                <div class="ukr-dots">
                  ${this.organizations.map((_, i) => `
                    <button class="ukr-dot ${i === 0 ? 'active' : ''}" data-index="${i}" aria-label="Go to slide ${i + 1}"></button>
                  `).join('')}
                </div>
                <button class="ukr-nav next" aria-label="Next slide">
                  <svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
                </button>
              </nav>
            </div>
          </div>
        </div>
      `;

      this.container.innerHTML = html;
    }

    cacheElements() {
      this.wrapper = this.container.querySelector('.ukr-wrapper');
      this.track = this.container.querySelector('.ukr-track');
      this.trackContainer = this.container.querySelector('.ukr-track-container');
      this.slides = Array.from(this.container.querySelectorAll('.ukr-slide'));
      this.videos = Array.from(this.container.querySelectorAll('.ukr-video'));
      this.navContainer = this.container.querySelector('.ukr-nav-container');
      this.prevBtn = this.navContainer.querySelector('.ukr-nav.prev');
      this.nextBtn = this.navContainer.querySelector('.ukr-nav.next');
      this.dots = Array.from(this.navContainer.querySelectorAll('.ukr-dot'));
    }

    async preloadCriticalAssets() {
      // Preload only current slide's assets
      const promises = [];

      // Current logo
      const currentOrg = this.organizations[this.current];
      if (currentOrg.logo) {
        promises.push(new Promise((resolve) => {
          const img = new Image();
          img.onload = resolve;
          img.onerror = resolve;
          img.src = currentOrg.logo;
        }));
      }

      // Wait for critical assets
      await Promise.all(promises);
    }

    setupVideos() {
      this.videos.forEach((video, index) => {
        // Basic setup
        video.muted = true;
        video.playsInline = true;
        video.setAttribute('webkit-playsinline', 'true');
        video.setAttribute('x5-playsinline', 'true');
        video.disableRemotePlayback = true;

        // Performance optimizations
        video.preload = 'none';

        // Set up reverse playback
        this.setupReversePlayback(video, index);

        // Handle video events
        video.addEventListener('loadedmetadata', () => {
          const card = video.closest('.ukr-card');
          card.classList.remove('loading');
          video.classList.add('loaded');
        });

        video.addEventListener('error', (e) => {
          console.warn(`Video error for slide ${index}:`, e);
          const card = video.closest('.ukr-card');
          card.classList.remove('loading');
          this.loadingVideos.delete(index);
        });
      });
    }

    setupReversePlayback(video, index) {
      let reverseInterval = null;
      let isReversing = false;

      video._startReverse = () => {
        if (isReversing || this.isDestroyed) return;
        isReversing = true;

        reverseInterval = setInterval(() => {
          if (this.isDestroyed || !isReversing) {
            clearInterval(reverseInterval);
            return;
          }

          if (video.currentTime <= 0.1) {
            clearInterval(reverseInterval);
            isReversing = false;
            video.currentTime = 0;

            // Restart if still active
            if (!this.isDestroyed && this.slides[index].classList.contains('active')) {
              setTimeout(() => this.playVideo(index), 100);
            }
            return;
          }

          video.currentTime = Math.max(0, video.currentTime - (CONFIG.frameInterval / 1000) * 2);
        }, CONFIG.frameInterval);
      };

      video.addEventListener('ended', () => {
        if (!this.isDestroyed && this.slides[index].classList.contains('active')) {
          video._startReverse();
        }
      });

      // Cleanup function
      video._cleanup = () => {
        if (reverseInterval) {
          clearInterval(reverseInterval);
          reverseInterval = null;
        }
        isReversing = false;
        video.pause();
        video.currentTime = 0;
        video.removeAttribute('src');
        video.load();
      };
    }

    async loadVideo(index) {
      if (this.isDestroyed || this.loadingVideos.has(index)) return;
      if (this.videoCache.has(index)) return;

      const video = this.videos[index];
      if (!video) return;

      this.loadingVideos.add(index);
      const card = video.closest('.ukr-card');
      card.classList.add('loading');

      return new Promise((resolve) => {
        const timeout = setTimeout(() => {
          this.loadingVideos.delete(index);
          card.classList.remove('loading');
          resolve(false);
        }, CONFIG.videoTimeout);

        const handleLoad = () => {
          clearTimeout(timeout);
          this.loadingVideos.delete(index);
          this.videoCache.set(index, true);
          resolve(true);
        };

        video.addEventListener('canplay', handleLoad, { once: true });

        // Set source and load
        const source = video.querySelector('source');
        if (source && !video.src) {
          video.src = source.src;
        }
        video.load();
      });
    }

    async playVideo(index) {
      if (this.isDestroyed) return;

      const video = this.videos[index];
      if (!video) return;

      // Ensure video is loaded
      if (!this.videoCache.has(index)) {
        await this.loadVideo(index);
      }

      // Clean up any reverse playback
      if (video._cleanup) {
        const source = video.querySelector('source');
        if (source) {
          video.src = source.src;
          video.load();
        }
      }

      // Reset and play
      video.currentTime = 0;

      try {
        await video.play();
      } catch (error) {
        if (error.name !== 'AbortError') {
          console.warn(`Play error for video ${index}:`, error);
        }
      }
    }

    stopVideo(index) {
      const video = this.videos[index];
      if (video && video._cleanup) {
        video._cleanup();
      }
    }

    updateCarousel(animate = true) {
      if (this.isTransitioning && animate) return;
      if (this.isDestroyed) return;

      this.isTransitioning = animate;

      // Calculate position
      const slideWidth = this.slides[0]?.offsetWidth || this.trackContainer.offsetWidth;
      const containerWidth = this.trackContainer.offsetWidth;

      let translateX;
      if (this.isMobile) {
        // Simple calculation for mobile - slides are full width
        translateX = -(this.current * containerWidth);
      } else {
        const centerOffset = (containerWidth - slideWidth) / 2;
        translateX = centerOffset - (this.current * slideWidth);
      }

      // Batch DOM updates
      this.rafId = raf(() => {
        if (this.isDestroyed) return;

        // Update track
        this.track.style.transition = animate ?
          `transform ${this.isMobile ? CONFIG.animationDurationMobile : CONFIG.animationDuration}ms var(--ukr-flow)` :
          'none';
        this.track.style.transform = `translate3d(${translateX}px, 0, 0)`;

        // Update slides in batch
        this.slides.forEach((slide, i) => {
          const isActive = i === this.current;
          const isAdjacent = !this.isMobile && Math.abs(i - this.current) <= 1;

          // Use classList for better performance
          slide.classList.toggle('active', isActive);
          slide.classList.toggle('pre-active', isAdjacent && !isActive);
        });

        // Handle videos
        this.updateVideos();

        // Update navigation
        this.updateNavigation();

        // Clear transition flag
        if (animate) {
          setTimeout(() => {
            this.isTransitioning = false;
          }, this.isMobile ? CONFIG.animationDurationMobile : CONFIG.animationDuration);
        } else {
          this.isTransitioning = false;
        }
      });
    }

    updateVideos() {
      const currentVideo = this.videos[this.current];

      // Play current video
      if (currentVideo) {
        setTimeout(() => {
          if (!this.isDestroyed && this.current === parseInt(currentVideo.dataset.index)) {
            this.playVideo(this.current);
          }
        }, CONFIG.videoLoadDelay);
      }

      // Stop other videos
      this.videos.forEach((video, i) => {
        if (i !== this.current) {
          this.stopVideo(i);
        }
      });
    }

    preloadNextVideos() {
      if (this.isDestroyed) return;

      // Preload adjacent videos
      const preloadIndexes = [];

      if (this.current > 0) {
        preloadIndexes.push(this.current - 1);
      }
      if (this.current < this.videos.length - 1) {
        preloadIndexes.push(this.current + 1);
      }

      preloadIndexes.forEach((index, i) => {
        setTimeout(() => {
          if (!this.isDestroyed) {
            this.loadVideo(index);
          }
        }, (i + 1) * 500);
      });
    }

    updateNavigation() {
      this.prevBtn.disabled = this.current === 0;
      this.nextBtn.disabled = this.current === this.slides.length - 1;

      this.dots.forEach((dot, i) => {
        dot.classList.toggle('active', i === this.current);
      });

      // Update scroll indicators for mobile
      if (this.isMobile) {
        this.trackContainer.classList.toggle('can-scroll-left', this.current > 0);
        this.trackContainer.classList.toggle('can-scroll-right', this.current < this.slides.length - 1);
      }
    }

    goToSlide(index) {
      if (index === this.current || index < 0 || index >= this.slides.length) return;
      if (this.isTransitioning || this.isDestroyed) return;

      this.current = index;
      this.updateCarousel();
      this.resetAutoplay();
      this.preloadNextVideos();
    }

    goNext() {
      if (this.current < this.slides.length - 1) {
        this.goToSlide(this.current + 1);
      } else {
        this.goToSlide(0); // Loop to start
      }
    }

    goPrev() {
      if (this.current > 0) {
        this.goToSlide(this.current - 1);
      }
    }

    startAutoplay() {
      if (this.isDestroyed) return;

      this.stopAutoplay();

      const delay = this.isMobile ? CONFIG.autoplayDelayMobile : CONFIG.autoplayDelay;
      this.autoplayTimer = setTimeout(() => {
        if (!this.isDestroyed) {
          this.goNext();
        }
      }, delay);
    }

    stopAutoplay() {
      if (this.autoplayTimer) {
        clearTimeout(this.autoplayTimer);
        this.autoplayTimer = null;
      }
    }

    resetAutoplay() {
      this.stopAutoplay();
      this.startAutoplay();
    }

    bindEvents() {
      // Navigation clicks - optimized
      this.handleNavClick = (e) => {
        const target = e.target.closest('button');
        if (!target || this.isDestroyed) return;

        e.preventDefault();

        if (target.classList.contains('prev')) {
          this.goPrev();
        } else if (target.classList.contains('next')) {
          this.goNext();
        } else if (target.classList.contains('ukr-dot')) {
          const index = parseInt(target.dataset.index, 10);
          if (!isNaN(index)) {
            this.goToSlide(index);
          }
        }
      };

      this.navContainer.addEventListener('click', this.handleNavClick, { passive: false });

      // Touch handling
      this.setupTouchHandling();

      // Keyboard navigation - desktop only
      if (!this.isMobile) {
        this.handleKeydown = (e) => {
          if (this.isDestroyed) return;

          if (e.key === 'ArrowLeft') {
            e.preventDefault();
            this.goPrev();
          } else if (e.key === 'ArrowRight') {
            e.preventDefault();
            this.goNext();
          }
        };

        document.addEventListener('keydown', this.handleKeydown, { passive: false });
      }

      // Hover pause - desktop only
      if (!this.isTouch) {
        this.container.addEventListener('mouseenter', () => this.stopAutoplay(), { passive: true });
        this.container.addEventListener('mouseleave', () => {
          if (!this.isDestroyed) this.startAutoplay();
        }, { passive: true });
      }

      // Optimized resize handling
      this.handleResize = debounce(() => {
        if (!this.isDestroyed) {
          deviceDetection.reset();
          const wasMobile = this.isMobile;
          this.isMobile = deviceDetection.isMobile();

          if (wasMobile !== this.isMobile) {
            // Device type changed - reset everything
            this.cleanup();
            this.updateCarousel(false);
            this.updateVideos();
          } else {
            // Just update layout
            this.updateCarousel(false);
          }
        }
      }, 250);

      window.addEventListener('resize', this.handleResize, { passive: true });

      // Visibility handling
      this.handleVisibilityChange = () => {
        if (document.hidden) {
          this.stopAutoplay();
          this.videos.forEach(video => video.pause());
        } else if (!this.isDestroyed && this.isInitialized) {
          this.playVideo(this.current);
          this.startAutoplay();
        }
      };

      document.addEventListener('visibilitychange', this.handleVisibilityChange);

      // Performance monitoring
      this.setupPerformanceObserver();
    }

    setupTouchHandling() {
      let touchStartX = 0;
      let touchStartY = 0;
      let isSwiping = false;
      let rafId = null;

      const threshold = this.isMobile ? CONFIG.swipeThresholdMobile : CONFIG.swipeThreshold;

      this.handleTouchStart = (e) => {
        if (this.isTransitioning || this.isDestroyed) return;

        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
        isSwiping = false;

        this.stopAutoplay();
      };

      this.handleTouchMove = (e) => {
        if (!isSwiping && !this.isTransitioning && !this.isDestroyed) {
          const diffX = Math.abs(e.touches[0].clientX - touchStartX);
          const diffY = Math.abs(e.touches[0].clientY - touchStartY);

          if (diffX > diffY && diffX > 5) {
            isSwiping = true;
            if (this.isMobile) {
              e.preventDefault();
            }
          }
        }
      };

      this.handleTouchEnd = (e) => {
        if (!isSwiping || this.isTransitioning || this.isDestroyed) return;

        const touchEndX = e.changedTouches[0].clientX;
        const diffX = touchStartX - touchEndX;

        if (Math.abs(diffX) > threshold) {
          if (diffX > 0) {
            this.goNext();
          } else {
            this.goPrev();
          }
        }

        setTimeout(() => {
          if (!this.isDestroyed) {
            this.startAutoplay();
          }
        }, 2000);
      };

      // Use passive listeners for better scrolling performance
      this.trackContainer.addEventListener('touchstart', this.handleTouchStart, { passive: true });
      this.trackContainer.addEventListener('touchmove', this.handleTouchMove, { passive: false });
      this.trackContainer.addEventListener('touchend', this.handleTouchEnd, { passive: true });
    }

    setupPerformanceObserver() {
      // Monitor carousel visibility for performance
      const observerOptions = {
        root: null,
        rootMargin: '50px',
        threshold: 0
      };

      this.observer = new IntersectionObserver((entries) => {
        if (this.isDestroyed) return;

        entries.forEach(entry => {
          if (entry.isIntersecting) {
            if (this.isInitialized) {
              this.playVideo(this.current);
              this.startAutoplay();
            }
          } else {
            this.stopAutoplay();
            this.videos.forEach(video => video.pause());
          }
        });
      }, observerOptions);

      this.observer.observe(this.container);
    }

    cleanup() {
      // Stop all videos
      this.videos.forEach((video, i) => {
        this.stopVideo(i);
      });

      // Clear all pending operations
      this.pendingOperations.forEach(timer => clearTimeout(timer));
      this.pendingOperations.clear();

      // Clear video cache
      this.videoCache.clear();
      this.loadingVideos.clear();
    }

    destroy() {
      this.isDestroyed = true;

      // Cancel any pending animation frames
      if (this.rafId) {
        caf(this.rafId);
      }

      // Clean up
      this.stopAutoplay();
      this.cleanup();

      // Remove event listeners
      if (this.navContainer) {
        this.navContainer.removeEventListener('click', this.handleNavClick);
      }

      if (this.trackContainer) {
        this.trackContainer.removeEventListener('touchstart', this.handleTouchStart);
        this.trackContainer.removeEventListener('touchmove', this.handleTouchMove);
        this.trackContainer.removeEventListener('touchend', this.handleTouchEnd);
      }

      if (!this.isMobile && this.handleKeydown) {
        document.removeEventListener('keydown', this.handleKeydown);
      }

      window.removeEventListener('resize', this.handleResize);
      document.removeEventListener('visibilitychange', this.handleVisibilityChange);

      if (this.observer) {
        this.observer.disconnect();
      }

      // Clear references
      this.container = null;
      this.slides = null;
      this.videos = null;
    }
  }

  // Global instance management
  let carouselInstance = null;

  const initCarousel = () => {
    // Clean up any existing instance
    if (carouselInstance) {
      carouselInstance.destroy();
      carouselInstance = null;
    }

    // Create new instance
    carouselInstance = new UkraineCarousel();

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (carouselInstance) {
        carouselInstance.destroy();
      }
    }, { once: true });
  };

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCarousel);
  } else {
    // Small delay to ensure resources are ready
    raf(() => {
      setTimeout(initCarousel, 100);
    });
  }
})();
</script>

<!-- HTML Body (Place where you want the carousel) -->
<div id="ukraine-support-carousel"></div>
